#!/usr/bin/ruby
$:.push '/home/ebrodeur/Projects/bin_snippets/lib'
Version = "0.0.1"
Banner = "This is a utilty to help identify duplicate files in a list and print them to console."

require 'cli'
include ErnieBrodeur

Options.parse!

### The app starts here.
require 'digest/md5'
Checksums = {}
def collect_md5sum(file)
	# Is this a directory? lets call ourself a bunch to figure this shit out.
	if Dir.exist? file
		Dir.glob("#{file}/*").each {|f| collect_md5sum f}
	elsif File.exist? file
		md5 = Digest::MD5.hexdigest open(file).read()
		md5 = md5.to_sym
		Checksums[md5] = [] if !Checksums[md5]
		Checksums[md5].push file
		Checksums[md5]
	end
end


Options.on_pry

if ARGV.any?
	ARGV.each do |f|
		collect_md5sum f
	end
end

Checksums.each do |k,v|
	if !v.one?
		puts "Found duplicates for #{k}, files:"
		v.each do |i|
			puts "#{i}"
		end
	end
end
